- 说明：本文是对这个比赛第三名解决方案的理解，参考了第三名提交的PDF证明和代码
- 第三名的解决方案[]

## 符号标识

- M：满足题目要求的所有匹配集合（即三胞胎和双胞胎拥有相同礼物）
- M'：所有可能的匹配集合
- 明显地，M是M'的子集
- CH(m)：m匹配方案下所有childID的6*ChildHappiness的和
- SH(m)：m匹配方案下所有giftID的6*GiftHappiness的和
- 其中m属于M'，这里乘以6是为了让这里的值都是整数
- 目标为寻找最大化S(m)的m，其中m属于M，S(m)={10*CH(m)}^3+{SH(m)}^3，推导见下图：

## 方案流程

### huge1.py

- 对所有可能的匹配m属于M'，计算CH(m)可能取得的最大值，代码见./harada/note_for_proof/proof_lemma3_hoge1.ipynb
- 经过上述计算，得到对于所有可能的匹配，CH(m)的最大值为1173959626
- 由于M为M'的子集，对于所有满足题目要求的匹配m属于M，CH(m)一定小于等于1173959626
- 又由于满足题目要求匹配的CH(m)一定是6的倍数，二1173959626对6取余得4，所以CH(m)一定小于等于1173959622

### huge2.py

- 经过多次尝试，我们发现很难满足双胞胎[34267,34268]的礼物要求，令M'_j属于M'，其中j为礼物编号，取值为0-999，表示将礼物j给双胞胎[34267,34268]的匹配集合。
- 通过令CH(m)=1173959622我们得到j=207，所以当且仅当将giftID=207的礼物给双胞胎[34267,34268]时CH(m)才满足上面的取值
- 这个搜索过程我们使用了强力搜索，代码见./harada/note_for_proof/proof_proposition4_lemma5_hoge2_3.ipynb

### huge3.py

- 通过这一步可以减少上述搜索范围
- 通过在忽略[34267,34268]情况下，最大化CH(m)，得到CH(m)的最大值为1173959632
- 那么在[34267,34268]不满足的情况下，CH(m)的最大值为1173959620

### huge4.py

- 下面我们通过在CH(m)=1173959622的情况下，最大化SH(m)
- 我们只需要搜索M'_j的匹配集，其中j=207
- 这里我们最大化10000*CH(m)+SH(m)，通过huge4.py中解决一个min-cost max-flow问题，得到SH(m)最大值为1703388

- 上面我们已经证明了对于所有满足要求的匹配，CH(m)最大值为1173959622，在CH(m)取最大值的情况下，SH(m)的最大值为1703388
- 为了方便，我们令S_M = (10*1173959622)^3 + 1703388^3
- 下面我们要说明较小的数不能比较大的数小太多(why)

### hoge5.py

- 首先，解决在所有匹配m属于M'中，最大化10000*CH(m)+2*SH(m)问题
- 通过min-cost max-flow问题得到CH(m)=1173959622,SH(m)=1709307
- 这表明，若CH(m)=1173959622-n,SH(m)小于等于17909307+5000*n
- 通过简单计算我们得到{10*(1173959622-n)}^3+(1709307+5000*n)^3小于等于S_M,当n属于[1,181341]
- 所以验证了对于所有匹配情况，当CH(m)属于(1173778280,1173959622)时，S(m)小于等于S_M

- 接下来，解决在所有匹配m属于M'中，最大化100*CH(m)+SH(m)问题
- 通过min-cost max-flow问题得到CH(m)=1173783829,SH(m)=33226746
- 所以验证了对于所有匹配情况，当CH(m)属于(1111594268,1173783839)时，S(m)小于等于S_M
